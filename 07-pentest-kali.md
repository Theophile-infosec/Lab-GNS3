# Pentest & Simulation d’attaques depuis Kali Linux<br>
<br>

**Sommaire** : <br>

I. [Reconnaissance active (approche pentest)](#i-reconnaissance-active-approche-pentest) <br>
II. [Reconnaissance passive (simulation attaquant)](#ii-reconnaissance-passive-simulation-attaquant) <br>

<br>

# Objectifs :<br>
<br>
Objectifs :

Utiliser des techniques de reconnaissance et d’énumération basiques afin de vérifier l’exposition réelle du laboratoire :
- Identifier les machines actives sur le réseau
- Observer les services réellement accessibles depuis un VLAN client
- Tester le filtrage inter-VLAN via des scans réseau contrôlés
- Évaluer les informations exposées par le service DNS
- Simuler une approche attaquant (reconnaissance active et passive)
- Valider que la surface d’attaque reste limitée

**Topologie du laboratoire :**
<br>
<br>
<img width="650" height="470" alt="image" src="https://github.com/user-attachments/assets/d09ce27c-da24-4c96-9fd3-ba25d22ab20e" />
<br>

- Serveur DHCP : Linux_Server-1 (e0)
- Clients : Linux_Desktop-1 (e0), Windows-10_Desktop-1 (e0), Kali_Linux (e0)
- Commutation : Linux_Switch
- Pare-feu : Linux_Fierwall (e0)
- Plan d'adressage : VLAN10 → 10.10.10.0/24, VLAN20 → 10.10.20.0/24, VLAN30 → 10.10.30.0/24<br>
<br>

# Procédures :<br>
<br>

## I. Reconnaissance active (approche pentest)

### 1. Lister les machines actives

**Objectif** :
- Identifier rapidement les hôtes actifs sur le VLAN client.

Commande : <br>
*nmap -sn 10.10.10.0/24*

Fonctionnement :
- Désactive le port scan.
- Effectue uniquement la découverte d’hôtes.
- Utilise principalement ARP.

Résultat :
- Liste des machines actives du subnet.

<br>
<br>
Capture d'écran : <br>
<br>
<img width="378" height="149" alt="image" src="https://github.com/user-attachments/assets/b84dccce-0ea4-460e-a351-259912b35275" />
<br>
<br>
<br>

### 2. IP et MAC des machines actives

**Objectif** :
- Associer IP et adresses MAC des machines détectées.

Commande : <br>
*arp-scan --localnet*

Fonctionnement :
- Envoie des requêtes ARP broadcast.
- Interroge chaque IP du subnet local.
- Récupère IP + MAC réelles.

Résultat :
- Liste IP / MAC des machines actives.

<br>
<br>
Capture d'écran : <br>
<br>
<img width="534" height="56" alt="image" src="https://github.com/user-attachments/assets/6b5e8c99-ed68-4816-a3f8-bcbac86d9b5d" />
<br>
<br>
<br>

### 3. Port scan complet serveur

**Objectif** :
- Identifier les services réellement exposés sur le VLAN serveur.

Commande : <br>
*nmap -sS -Pn -p- 10.10.30.1<br>
nmap -sV -sC -Pn 10.10.30.1*

Fonctionnement :
- *-sS* : scan SYN (half-open : SYN -> SYN/ACK -> RST).
- *-Pn* : ignore le ping initial.
- *-p-* : scan des 65535 ports.
- *-sV* : détection de version.
- *-sC* : lance des scripts NSE (Nmap Scripting Engine).

Résultat :
- Seul le port DNS 53 apparaît ouvert.
- Service identifié : BIND.

<br>
<br>
Capture d'écran : <br>
<br>

*nmap -sS -Pn -p- 10.10.30.1*
<br>
<img width="420" height="83" alt="image" src="https://github.com/user-attachments/assets/15fb6134-bad0-42b9-a15c-9d017ca9f0b6" /><br>
*nmap -sV -sC -Pn 10.10.30.1*<br>
<img width="574" height="87" alt="image" src="https://github.com/user-attachments/assets/ed988452-7a01-4632-bb21-fe4525e5c9d6" />

<br>
<br>
<br>

### 4. Scan du dubnet distant

**Objectif** :
- Observer le comportement du firewall lors d’un scan inter-VLAN.

Commande : <br>
*nmap -sS -Pn 10.10.30.0/24*

Fonctionnement :
- Envoi de SYN vers chaque IP.
- Le firewall route mais filtre le trafic.

Résultat :
- Hosts majoritairement en état filtered.
- Scan peu fiable.

<br>
<br>
Capture d'écran : <br>
<br>
<img width="505" height="168" alt="image" src="https://github.com/user-attachments/assets/bdabe24b-13bb-4e5e-b314-9b937bc6bb5b" />
<br>
<br>
<br>

### 5. Port scan complet client

**Objectif** :
- Vérifier qu’aucun service n’est exposé côté client.

Commande : <br>
*nmap -sS -Pn 10.10.10.101*

Fonctionnement :
- Scan SYN classique.
- Vérifie ports accessibles.

Résultat :
- Host actif.
- Aucun service exposé.

<br>
<br>
Capture d'écran : <br>
<br>
<img width="516" height="62" alt="image" src="https://github.com/user-attachments/assets/1b0604e8-84d7-48b1-801c-fe0bb0a54d61" />
<br>
<br>
<br>

### 6. Test de récursion DNS

**Objectif** :
- Vérifier si le DNS autorise la résolution externe.

Commande : <br>
*dig google.com @10.10.30.1*

Résultat :
- SERVFAIL.
- DNS autoritaire uniquement (pas de récursion).

<br>
<br>
Capture d'écran : <br>
<br>
<img width="583" height="55" alt="image" src="https://github.com/user-attachments/assets/2d43f77d-6201-4f73-9950-40458d750192" />
<br>
<br>
<br>

### 7. Énumération DNS

**Objectif** :
- Observer les informations accessibles via une énumération standard.

Commande : <br>
*dnsrecon -d lab.local*

Fonctionnement :
- Recherche des enregistrements DNS connus (SOA, NS, A, etc...).
- Tentative de découverte de services (SRV).

Résultat :
- SOA et NS uniquement.
- Pas d’informations sensibles exposées.

<br>
<br>
Capture d'écran : <br>
<br>
<img width="635" height="129" alt="image" src="https://github.com/user-attachments/assets/6498241f-dda8-45c7-87b3-2ece0132b9b4" />
<br>
<br>
<br>

## II. Reconnaissance passive (simulation attaquant)

### 1. Vérification réseau local

**Objectif** :
- Identifier IP locale et subnet.

Commande : <br>
*ip a*

**Détection (défense)** :
- Aucune requête réseau générée → impossible à détecter côté réseau
- Visible uniquement via monitoring local (EDR / audit système)

<br>
<br>
Capture d'écran : <br>
<br>
<img width="498" height="82" alt="image" src="https://github.com/user-attachments/assets/e9121517-cab7-4264-a5aa-b407e7a73ea8" />
<br>
<br>
<br>

### 2. Vérification passerelle

**Objectif** :
- Identifier la gateway.
- Comprendre le routage.

Commande : <br>
*ip route*

**Détection (défense)** :
- Aucune requête réseau générée → impossible à détecter côté réseau
- Visible uniquement via monitoring local (EDR / audit système)

<br>
<br>
Capture d'écran : <br>
<br>
<img width="679" height="59" alt="image" src="https://github.com/user-attachments/assets/87de3c00-f68c-4639-9e3e-3250c7105b08" />
<br>
<br>
<br>

### 3. Machines déjà connues

**Objectif** :
- Voir les hôtes déjà contactés.

Commande : <br>
*ip neigh*

**Détection (défense)** :
- Aucune requête réseau générée → impossible à détecter côté réseau
- Lecture du cache ARP local uniquement
- Visible uniquement via monitoring local (EDR / audit système)

<br>
<br>
Capture d'écran : <br>
<br>
<img width="517" height="43" alt="image" src="https://github.com/user-attachments/assets/112ef8e7-e765-4650-be5f-99da194b45c6" />
<br>
<br>
<br>

### 4. DNS utilisé

**Objectif** :
- Identifier le serveur DNS interne.
- Déduire architecture réseau.

Commande : <br>
*cat /etc/resolv.conf*

**Détection (défense)** :
- Aucune requête réseau générée → impossible à détecter côté réseau
- Lecture locale du fichier de configuration
- Visible uniquement via monitoring local (EDR / audit système)

<br>
<br>
Capture d'écran : <br>
<br>
<img width="269" height="76" alt="image" src="https://github.com/user-attachments/assets/b4384724-66e1-4168-8d3a-110190222c29" />
<br>
<br>
<br>

### 5. Test ANY DNS

**Objectif** :
- Tester les informations exposées par le DNS

Commande : <br>
*dig any lab.local @10.10.30.1*

Fonctionnement :
- Envoie une requête DNS de type ANY au serveur -> retourne tous les enregistrements disponibles pour un nom

Résultat :
- SOA et NS uniquement.
- Pas d’informations sensibles exposées.

**Détection (défense)** :
- Requête DNS standard (type ANY) -> trafic similaire à une requête DNS normale
- Identifiable uniquement via analyse fine des logs DNS


<br>
<br>
Capture d'écran : <br>
<br>
<img width="774" height="84" alt="image" src="https://github.com/user-attachments/assets/43144011-6b24-4c05-a1c9-966f1a9ccd50" />
<br>
<br>
<br>

### 6. Test de transfert de zone (AXFR)

**Objectif** :
- Vérifier si le serveur autorise l’export complet de la zone
- Récupérer la cartographie DNS interne

Commande : <br>
*dig axfr lab.local @10.10.30.1*

Fonctionnement :
- Tente un transfert complet de zone DNS.
- Permettrait d’obtenir tous les enregistrements DNS si autorisé.

Résultat :
- Le transfert est limité.
- Aucune donnée critique exposée.

**Détection (défense)** :
- Requête DNS de type AXFR très identifiable
- Facilement détectable dans les logs DNS -> souvent considéré comme suspect


<br>
<br>
Capture d'écran : <br>
<br>
<img width="759" height="118" alt="image" src="https://github.com/user-attachments/assets/03fb2b0e-9386-4a43-9e82-b6b62d21f793" />
<br>
<br>
<br>

### 7. Scan nmap ciblé

**Objectif** :
- Identifier les services principaux accessibles
- Réduire le bruit réseau via un scan ciblé

Commande : <br>
*nmap -sS -Pn -p 22,53,80,443 10.10.30.1*

Fonctionnement :
- Scan SYN (*-sS*) : envoie uniquement le début du handshake TCP (half-open : SYN -> SYN/ACK -> RST)
- *-Pn* : ignore la phase de découverte ICMP
- scan ciblé sur ports standards (SSH, DNS, HTTP, HTTPS)

Résultat :
- Seul le port DNS (53/TCP) apparaît accessible
- Ports 22, 80 et 443 filtrés par le firewall
- Validation du filtrage inter-VLAN

**Détection (défense)** :
- Plusieurs SYN vers ports différents
- Pattern clair de scan réseau
- Détectable par firewall stateful / IDS


<br>
<br>
Capture d'écran : <br>
<br>

Résultat nmap :
<br>
<img width="205" height="88" alt="image" src="https://github.com/user-attachments/assets/f44e8ce6-39a6-42e1-b31c-23ddd4a9ff27" />
<br>
Half-open scan<br>
<img width="560" height="58" alt="image" src="https://github.com/user-attachments/assets/323c59a9-e6c7-40f3-84de-e051d47d1c2e" />
<br>
<br>
<br>

### 8. Identifier la version du service

**Objectif** :
- Identifier précisément la version du service DNS
- Rechercher d’éventuelles vulnérabilités associées

Commande : <br>
*nmap -sS -Pn -sV -p 53 10.10.30.1*

Fonctionnement :
- *-sV* active la détection de version applicative
- Tente d’identifier logiciel, version et OS

Résultat :
- Service détecté : ISC BIND
- Version & OS identifiée

**Détection (défense)** :
- Connexions multiples sur un même port -> comportement typique de fingerprinting
- Visible dans les logs applicatifs DNS


<br>
<br>
Capture d'écran : <br>
<br>
<img width="574" height="87" alt="image" src="https://github.com/user-attachments/assets/c8ad2965-0f2c-40ad-a0a5-1612971c1452" />
<br>
<br>
<br>

# Conclusion :<br>
<br>

Les tests réalisés montrent que :
- la segmentation VLAN limite fortement la visibilité réseau
- le firewall inter-VLAN bloque efficacement les services non autorisés
- seul le service DNS est exposé depuis le VLAN client
- aucune fuite majeure via énumération DNS
- les clients n’exposent aucun service exploitable
La phase de reconnaissance confirme que la surface d’attaque observable reste volontairement réduite et cohérente avec la politique de sécurité du laboratoire.
